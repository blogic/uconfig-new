#!/usr/bin/ucode

'use strict';

import * as libubus from 'ubus';
import * as uloop from 'uloop';
import * as devices from 'uconfig.state.devices';
import * as radios from 'uconfig.state.radios';
import * as traffic from 'uconfig.state.traffic';

let ubus = libubus.connect();

devices.init();
traffic.init();

let ubus_methods = {
	...devices.methods,
	...radios.methods,
	...traffic.methods
};

uloop.init();
ubus.publish('uconfig-ui', ubus_methods);

uloop.interval(900000, function() {
	devices.update();
});

uloop.interval(10000, function() {
	traffic.update();
});

uloop.run();
